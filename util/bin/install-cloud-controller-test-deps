#!/bin/bash

set -xeuo pipefail

sudo apt-get update
sudo apt-get -y install postgresql postgresql-contrib libpq-dev libmysqlclient-dev

sudo -u postgres psql -c "SELECT version();"

pushd /home/vagrant/workspace/cloud_controller_ng
    bundler_version="$(cat Gemfile.lock | grep -A1 "BUNDLED WITH" | tail -1 | tr -d ' ')"
    gem install --user-install bundler --version "$bundler_version"

    bundle install 
    DB=postgres rake db:create
popd
