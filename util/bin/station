#!/bin/bash

set -euo pipefail

if ! ssh-add -L 2>&1 >/dev/null; then
  echo "No ssh key is loaded. Please add your ssh key before running this script!"
  exit 1
fi

export EIRINI_STATION_USERNAME="${STATION_USER:-$(ssh-add -L | cut -d ' ' -f 3 | cut -d @ -f 1)}"

function usage_text() {
  cat <<EOF
A thin wrapper over the gcloud cli to help manage your gcp eirini workstation

Usage:
  $(basename "$0") [auth|create|destroy|describe|provision|start|stop|ssh]

EOF
  exit 1
}

command="${1:-}"
case "$command" in

  "auth" | "create" | "destroy" | "provision" | "start" | "stop" | "ssh")
    "$HOME/workspace/eirini-station/gcp/${command}.sh"
    ;;

  "describe")
    gcloud compute instances describe --project cff-eirini-peace-pods --zone="europe-west2-a" "$EIRINI_STATION_USERNAME-eirini-station"
    ;;

  *)
    usage_text
    ;;
esac
